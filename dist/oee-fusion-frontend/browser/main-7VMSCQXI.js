import{a as Y,b as F,c as q,d as I}from"./chunk-ICRGXVC6.js";import{a as _,e as et}from"./chunk-FTGQ4SWQ.js";import{a as w,b as s,c as K,d as Q,e as V,f as W,g as p,h as L,i as j,j as E,k as X}from"./chunk-5WQAUWMP.js";import{$ as C,Aa as b,B as A,F as O,Ib as B,Mb as J,Na as G,Pa as R,Qa as T,Sa as N,Sb as $,T as d,Ta as l,Tb as z,Ua as v,Ub as Z,Va as h,W as S,Za as P,aa as f,fb as D,ga as y,hb as H,jb as x,o as a,rg as tt,u as k,za as g}from"./chunk-JVLTY23R.js";var ot=e=>d({next:t=>localStorage.setItem(e,JSON.stringify(t)),error:()=>localStorage.removeItem(e)});var rt=(()=>{let t=class t{constructor(o){this.crud=o}register(o){return this.crud.create("/auth/register",o)}login(o){return this.crud.create("/auth/login",o)}getUserInfo(){return this.crud.read("/user")}};t.\u0275fac=function(r){return new(r||t)(C(_))},t.\u0275prov=S({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var c,n=(c=class{constructor(t,i){this.authService=t,this.router=i}static isLoggedIn(t){return t?.loggedIn}login({patchState:t},{payload:i}){return this.authService.login(i).pipe(k(o=>o.access_token),ot("token"),d({next:o=>{t({token:o,loggedIn:!0,loginError:null}),this.router.navigate(["/"])},error:o=>t({loginError:o.error})}))}getUserInfo({patchState:t,dispatch:i}){return t({token:localStorage.getItem("token")}),this.authService.getUserInfo().pipe(d({next:o=>{t({userInfo:o,loggedIn:!0})},error:o=>{t({token:null,loggedIn:!1}),i(new I)}}))}signUp({patchState:t},{payload:i}){return this.authService.register(i).pipe(d({next:()=>{t({signUpError:null}),this.router.navigate(["/"])},error:o=>{t({signUpError:o.error})}}))}logout({patchState:t,getState:i}){console.log("Logging out"),t({token:null,loggedIn:!1}),console.log("Logged out, redirecting to login page",i()),localStorage.removeItem("token")}},c.\u0275fac=function(i){return new(i||c)(C(rt),C(s))},c.\u0275prov=S({token:c,factory:c.\u0275fac}),c);a([L(Y)],n.prototype,"login",null);a([L(F)],n.prototype,"getUserInfo",null);a([L(q)],n.prototype,"signUp",null);a([L(I)],n.prototype,"logout",null);a([E()],n,"isLoggedIn",null);n=a([j({name:"auth",defaults:{token:null,loggedIn:null,userInfo:null,signUpError:null,loginError:null}})],n);var it=(e,t)=>{let i=f(p),o=f(s);return i.select(n.isLoggedIn).pipe(A(r=>r!==null),O(1),k(r=>r?!0:o.parseUrl("/login")))},nt=(e,t)=>{let i=f(p),o=f(s);return i.select(n.isLoggedIn).pipe(A(r=>r!==null),O(1),k(r=>r?o.parseUrl("/dashboard"):!0))};function gt(e,t){if(e&1&&(l(0,"li",5)(1,"a",6),h(2,"i"),D(3),v()()),e&2){let i=t.$implicit;g(),R("routerLink",i.link),g(),N("me-3 text-2xl fa-solid ",i.icon,""),g(),H(" ",i.title," ")}}var at=(()=>{let t=class t{constructor(o,r){this.store=o,this.router=r,this.items=[{title:"Dashboard",icon:"fa-chart-line",link:"/dashboard"},{title:"Machines",icon:"fa-grip",link:"/machines"},{title:"Profile",icon:"fa-user",link:"/profile"},{title:"Settings",icon:"fa-gear",link:"/settings"}]}logout(){this.store.dispatch(new I).subscribe(()=>{console.log("Logged out, redirecting to login page"),this.router.navigate(["/login"])})}};t.\u0275fac=function(r){return new(r||t)(b(p),b(s))},t.\u0275cmp=y({type:t,selectors:[["app-side-menu"]],standalone:!0,features:[x],decls:7,vars:1,consts:[[1,"sidebar","h-full","border-r","border-muted"],[1,"flex","flex-col","h-full","justify-center","gap-3","px-8","bg-bg"],["class","",4,"ngFor","ngForOf"],[1,"nav-link","text-lg","text-danger",3,"click"],[1,"me-3","text-2xl","fa-solid","fa-sign-out-alt"],[1,""],["routerLinkActive","text-primary",1,"nav-link","text-lg","text-muted",3,"routerLink"]],template:function(r,u){r&1&&(l(0,"nav",0)(1,"ul",1),G(2,gt,4,5,"li",2),l(3,"li")(4,"button",3),P("click",function(){return u.logout()}),h(5,"i",4),D(6," Logout "),v()()()()),r&2&&(g(2),R("ngForOf",u.items))},dependencies:[J,B,W,K,Q]});let e=t;return e})();var lt=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=y({type:t,selectors:[["app-layout"]],standalone:!0,features:[x],decls:5,vars:4,consts:[[1,"layout-grid"],[1,"overflow-auto"],[1,"px-8","py-5"]],template:function(r,u){r&1&&(l(0,"div",0),h(1,"app-side-menu"),l(2,"main",1)(3,"div",2),h(4,"router-outlet"),v()()()),r&2&&(g(),T("grid-area","sidebar"),g(),T("grid-area","main"))},dependencies:[at,w],styles:['.layout-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto 1fr;grid-template-areas:"header header" "sidebar main";height:100vh;width:100vw}']});let e=t;return e})();var st=[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"",children:[{path:"login",loadComponent:()=>import("./chunk-P63B2M7G.js").then(e=>e.LoginComponent)},{path:"sign-up",loadComponent:()=>import("./chunk-XRJ2IK2O.js").then(e=>e.SignUpComponent)}],canActivate:[nt]},{path:"",component:lt,children:[{path:"dashboard",pathMatch:"full",loadComponent:()=>import("./chunk-G2RHLELW.js").then(e=>e.DashboardComponent)},{path:"machines",pathMatch:"full",loadComponent:()=>import("./chunk-C7JNAGT2.js").then(e=>e.MachinesComponent)}],canActivate:[it]}];var m,U=(m=class{static getState(t){return t}},m.\u0275fac=function(i){return new(i||m)},m.\u0275prov=S({token:m,factory:m.\u0275fac}),m);a([E()],U,"getState",null);U=a([j({name:"ui",defaults:{items:[]}})],U);var pt=(e,t)=>{let i=localStorage.getItem("token"),o=f(p),r=f(s);return i&&(e=e.clone({setHeaders:{Authorization:`Bearer ${JSON.parse(i)}`}})),t(e).pipe(d({error:u=>{u.status===401&&(o.dispatch(new I),console.log("(UNAUTHORIZED) Logging out due to 401 error"))}}))};var ct={providers:[V(st),X([n,U,et]),$(z([pt]))]};var mt=(()=>{let t=class t{constructor(o){this.store=o,[{deviceType:"desktop"},{deviceType:"tablet"},{deviceType:"phone"}].forEach(u=>{tt.defaultOptions({device:u,options:{validationMessageMode:"always",valueChangeEvent:"change"}})}),this.store.dispatch(new F)}};t.\u0275fac=function(r){return new(r||t)(b(p))},t.\u0275cmp=y({type:t,selectors:[["app-root"]],standalone:!0,features:[x],decls:2,vars:0,consts:[["id","wrapper",1,"dark"]],template:function(r,u){r&1&&(l(0,"div",0),h(1,"router-outlet"),v())},dependencies:[w]});let e=t;return e})();Z(mt,ct).catch(e=>console.error(e));
